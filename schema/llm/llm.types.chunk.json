{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://adaptersdk.org/schemas/llm/llm.types.chunk.json",
  "title": "LLM Stream Chunk",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "text": { "type": "string" },
    "is_final": { "type": "boolean", "default": false },
    "model": { "type": "string", "maxLength": 128 },
    "usage_so_far": { "$ref": "https://adaptersdk.org/schemas/llm/llm.types.token_usage.json" },
    "logprobs": { "$ref": "https://adaptersdk.org/schemas/llm/llm.types.logprobs.json" },
    "redactions": {
      "type": "array",
      "maxItems": 256,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["start", "end", "reason"],
        "properties": {
          "start": { "type": "integer", "minimum": 0 },
          "end": { "type": "integer", "minimum": 0 },
          "reason": { "type": "string", "maxLength": 128 }
        }
      }
    },
    "heartbeat": {
      "type": "boolean",
      "const": true,
      "description": "Keepalive frame; clients MUST ignore for content."
    },
    "json_stream_mode": {
      "type": "string",
      "enum": ["off", "object", "array"],
      "default": "off",
      "description": "If not 'off', text may represent an incrementally valid JSON fragment."
    },
    "tool_calls": {
      "type": "array",
      "maxItems": 16,
      "items": { "$ref": "https://adaptersdk.org/schemas/llm/llm.types.tool.json#/$defs/toolCall" }
    }
  },
  "oneOf": [
    { "required": ["text"] },
    { "required": ["heartbeat"], "properties": { "text": { "maxLength": 0 } } }
  ]
}
